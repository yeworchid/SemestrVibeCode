# Игра ОРИС - Сетевая стратегия

## Описание
Многопользовательская экономическая стратегия для 2-4 игроков. Игроки строят здания, добывают ресурсы, производят солдат и атакуют противников. Победитель определяется по количеству очков за ресурсы.

## Технологии
- C# .NET 9
- TCP сокеты
- WinForms (клиент)
- JSON для сериализации

## Запуск
1. Запустить Server: `dotnet run --project Server`
2. Запустить несколько экземпляров Client
3. Подключиться к серверу (localhost:5000)
4. Выбрать архетип
5. Играть

## Протокол передачи данных

### Формат сообщения
Каждое сообщение передается в формате:
```
[4 байта длины][ТИП|JSON_PAYLOAD]
```

Первые 4 байта - длина сообщения (int32).
Затем строка в формате "ТИП|JSON".

### Типы сообщений (15 типов)

| Тип | Направление | Описание |
|-----|-------------|----------|
| JOIN | клиент→сервер | Подключение к игре |
| START_GAME | сервер→клиент | Начало игры |
| ARCHETYPE | клиент→сервер | Выбор архетипа |
| START_TURN | сервер→клиент | Начало хода |
| PRODUCTION_RESULT | сервер→клиент | Результат производства |
| MAKE_SOLDIERS | клиент→сервер | Создание солдат |
| ATTACK | клиент→сервер | Атака игрока |
| ATTACK_TARGET | сервер→клиент | Результат атаки |
| BUILD | клиент→сервер | Постройка здания |
| UPGRADE | клиент→сервер | Улучшение здания |
| END_TURN | клиент→сервер | Конец хода |
| TURN_ENDED | сервер→клиент | Ход завершен |
| STATE | сервер→клиент | Состояние игрока |
| GAME_END | сервер→клиент | Конец игры |
| RESPONSE | сервер→клиент | Ответ на действие |

### Примеры сообщений

#### JOIN
```
JOIN|{"Nickname":"Игрок1","Email":"test@mail.ru"}
```

#### START_GAME
```
START_GAME|{"PlayerId":1,"PlayerCount":4}
```

#### BUILD
```
BUILD|{"PlaceId":5,"Type":0}
```

#### STATE
```
STATE|{"Resources":{"Wood":10,"Stone":8},"Soldiers":5,"Defense":20,"Buildings":[{"PlaceId":5,"Type":0,"Level":1}]}
```

## Правила игры

### Игровое поле
- Поле 5x5 клеток (25 мест для зданий)
- Каждое здание занимает одну клетку

### Ресурсы (4 класса)
- Класс 1 (1 очко): Дерево, Камень, Руда, Зерно
- Класс 2 (3 очка): Доски, Кирпичи, Металл, Уголь, Песок, Хлеб
- Класс 3 (8 очков): Мебель, Стены, Инструменты, Стекло, Оружие
- Класс 4 (25 очков): Золото, Изумруд

### Архетипы (8 типов)
- Жадина: +30% защита, -20% очки
- Меценат: +25% очки, -25% защита
- Воин: игнорирует 20% защиты, солдат стоит 5 хлеб + 2 оружие
- Новобранец: солдат стоит 1 хлеб + 1 оружие, +20% защиты врага
- Инженер: возврат 1-2 ресурсов при постройке, -20% очки
- Алхимик: +25% очки за золото/изумруд, -30% за остальное
- Обжора: солдат крадет 2 ресурса, стоит 6 хлеб + 1 оружие
- Нормис: без бонусов

### Ход игры (5 фаз)
1. Производство (автоматически)
2. Переработка (автоматически)
3. Создание солдат (опционально)
4. Атака (опционально, с 6 цикла)
5. Строительство/улучшение (опционально)

### Победа
Игра длится 15 циклов. Побеждает игрок с наибольшим количеством очков за ресурсы.

## Структура проекта
```
├── Common/           # Общие классы и DTO
│   ├── DTO/          # Data Transfer Objects
│   ├── Services/     # Сериализация и парсинг
│   └── ...           # Enums и модели
├── Server/           # Сервер игры
│   ├── GameServer.cs # Основная логика сервера
│   ├── GameLogic.cs  # Игровая логика
│   └── Player.cs     # Класс игрока
└── Client/           # WinForms клиент
    ├── Form1.cs      # Главная форма
    ├── BuildForm.cs  # Форма постройки
    └── GameFieldControl.cs # Визуализация поля
```
